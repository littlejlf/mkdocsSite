<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Lock - blog from lf</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Lock";
        var mkdocs_page_input_path = "lock.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
 <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> blog from lf
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">计算机理论</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../%E6%95%B0%E5%AD%A6%E9%80%BB%E8%BE%91/">数学逻辑</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../%E4%BF%A1%E6%81%AF%E8%AE%BA/">信息论</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sat/">Sat</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../incompleteness%20theorems/">Incompleteness theorems</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">编译原理</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../Context-free%20grammar/">Context free grammar</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F%E5%92%8C%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">None</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">静态分析、程序检测</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">None</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">并发</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../%E6%8A%A2%E5%8D%A0%E5%BC%8F%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/">抢占式线程模型</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../%E5%A4%9A%E5%A4%84%E7%90%86%E5%99%A8/">多处理器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../%E5%BC%82%E6%AD%A5%E5%92%8C%E5%B9%B6%E5%8F%91%E7%9A%84%E5%8C%BA%E5%88%AB/">异步和并发的区别</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="./">None</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CompletableFuture/">None</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">程序语言</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">java</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../java%E7%9A%84%E5%8A%A8%E6%80%81%E7%BB%91%E5%AE%9A%E7%9A%84%E5%8E%9F%E7%90%86/">Java的动态绑定的原理</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../%E6%B3%9B%E5%9E%8B%E4%BB%A5%E5%8F%8A%E5%8D%8F%E5%8F%98%E9%80%86%E5%8F%98/">泛型以及协变逆变</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../CompletableFuture/">CompletableFuture</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">Lock</a>
    <ul class="current">
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F%E5%92%8C%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">访问者模式和编译原理</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">操作系统</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">Welcome to MkDocs</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">杂项|运维|工具</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../%E5%BF%AB%E6%8D%B7%E9%94%AE/">快捷键</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F/">编码格式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7/">代理工具</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../comand/">Comand</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../docker/">Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../encoding-issues/">Encoding issues</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../git/">Git</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gradle/">Gradle</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../markdown/">Markdown</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">blog from lf</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">程序语言</li>
          <li class="breadcrumb-item">java</li>
      <li class="breadcrumb-item active">Lock</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/littlejlf/mkdocsSite/edit/master/docs/lock.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>好的资料
https://generalthink.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/</p>
<h5 id="mutex_monitor">mutex 和monitor的区别<a class="headerlink" href="#mutex_monitor" title="Permanent link">#</a></h5>
<p>语义不同：</p>
<p>Mutex：Mutex 是一种简单的同步原语，它提供了两种操作：lock（获取锁）和 unlock（释放锁）。当一个线程获得了 Mutex 后，其他线程必须等待该线程释放锁后才能获得锁。Mutex 并不提供其他附加的语义，如条件变量等。
Monitor：Monitor 是一种高级同步机制，它是一种包含了锁、条件变量和一些操作的抽象。除了提供类似 Mutex 的 lock 和 unlock 操作外，Monitor 还提供了等待和通知（wait 和 notify）机制，允许线程在某些条件下等待和唤醒其他线程。
关联性：</p>
<p>Mutex：Mutex 可以与任何数据结构或代码段一起使用，因为它是一种通用的同步原语。
Monitor：Monitor 通常与特定的类或对象关联，它提供了对这些对象的同步访问和控制。在 Java 中，每个对象都有一个关联的监视器，可以使用 synchronized 关键字来获取对象的监视器锁。
灵活性：</p>
<p>Mutex：Mutex 是一种低级同步原语，相对较为灵活，可以根据需要在任何地方使用。
Monitor：Monitor 是一种高级抽象，提供了更方便的等待和通知机制，但其使用受到限制，通常与特定的类或对象关联。
总的来说，Mutex 是一种简单的同步原语，而 Monitor 则是一种更高级的抽象，提供了更多的同步语义和操作，但其使用通常受到限制，适用于特定的类或对象。
 <strong><em>Monitor必须和锁一起用 不然会抛出异常 Thread.currency.wait（）没有使用场景直接是报错的 Thread.currency不能作为Monitor 每个线程中其实例都不同 Motitor只释放和自己绑定的锁</em></strong></p>
<h5 id="reentrantlock">ReentrantLock唤醒机制<a class="headerlink" href="#reentrantlock" title="Permanent link">#</a></h5>
<p>ReentrantLock 在被unlock 的时候会唤醒所有的等待的线程还是唤醒一个 唤醒的规则是怎么样的</p>
<p>ChatGPT
ReentrantLock 类的 unlock() 方法会释放锁，并唤醒等待该锁的线程。但是，它并不会像 synchronized 块那样自动唤醒所有等待的线程。具体唤醒的规则是：</p>
<p>公平性设置：如果 ReentrantLock 是公平锁（通过构造函数设置为公平锁），则等待时间最长的线程将会被唤醒，保证线程获取锁的顺序与其等待的顺序一致，实现公平性。</p>
<p>非公平性设置：如果 ReentrantLock 是非公平锁（默认情况下是非公平锁），则等待锁的所有线程中的任何一个都有机会被唤醒，这取决于操作系统的调度和 JVM 的实现。通常情况下，JVM 偏向于唤醒等待时间较长的线程，但并不保证按照等待顺序唤醒。</p>
<p>总的来说，唤醒哪个线程是不确定的，这取决于 JVM 的实现和当前系统的状态。公平性设置影响了唤醒的顺序，但并不是绝对的，而是一个倾向性的特性。</p>
<h5 id="interrupt_interruptedexception">interrupt()方法 InterruptedException<a class="headerlink" href="#interrupt_interruptedexception" title="Permanent link">#</a></h5>
<p>在Java中，interrupt() 方法是用来中断线程的。当你调用一个线程的 interrupt() 方法时，会设置该线程的中断状态为"中断"。但是，这并不意味着线程会立即停止执行。实际上，线程会继续执行，直到它检查到自己的中断状态，并且选择处理中断或者直接退出。</p>
<p>interrupt() 方法的行为会根据线程的不同状态而有所不同：
* 程序如果处于NEW 状态 那么调用interrupt() 方法相当于identity()</p>
<ul>
<li>
<p>如果线程处于运行状态（即正在执行任务），那么调用 interrupt() 方法会将线程的中断状态设置为"中断"。但线程不会立即停止执行，而是会继续运行下去,也不会报错。</p>
</li>
<li>
<p>如果线程处于阻塞状态（例如，调用了 Object.wait()、Thread.sleep()、Thread.join() 等等），那么调用 interrupt() 方法会中断线程的阻塞状态，并抛出 InterruptedException 异常。这时你可以在异常处理中选择继续执行（进入catch段后线程状态设为RUNNIG，线程也进入RUNNING，继续执行catch代码段后的代码）或者退出线程(),没有处理直接抛的话直接结束。</p>
</li>
</ul>
<p>如果线程处于非阻塞、非等待状态，但是检测到自己的中断状态为"中断"，那么线程可以选择在适当的时候终止执行，通常通过检查 Thread.currentThread().isInterrupted() 方法来判断中断状态并进行相应的处理。</p>
<h5 id="_1">公平锁和非公平锁<a class="headerlink" href="#_1" title="Permanent link">#</a></h5>
<p>线程切换的开销，其实就是非公平锁效率高于公平锁的原因，因为非公平锁减少了线程挂起的几率，后来的线程有一定几率逃离被挂起的开销。（一个线程A释放锁，刚好有另一个线程B来请求；这种情况下，非公平锁：B直接获取锁 公平锁：阻塞B加入队尾，唤醒队首线程来获取锁）</p>
<h5 id="_2">自旋锁<a class="headerlink" href="#_2" title="Permanent link">#</a></h5>
<p>线程协调中，自旋等待通常用于短暂等待，或者在预期等待时间较短且并发负载较轻的情况下。在长时间等待或者高并发负载下，更适合使用线程阻塞等待的方式，以避免资源浪费和性能下降。</p>
<h5 id="csa">CSA乐观锁<a class="headerlink" href="#csa" title="Permanent link">#</a></h5>
<p>用在并发少的情况
 * CAS本身是不会并发的，本身是原子的且会锁内存
 * 先比较再修改 不一致会返回false 发生冲突 回滚操作或记录日志等
 * ABA问题用版本号来两次CAS 每次修改版本号都加1 先执行版本号的CAS再执行值的CAS,只有两次CAS都通过可以修改
 减少了锁的获取和释放的开销，以及由于锁竞争导致的线程上下文切换的开销 一些阻塞是不必要的 即虽然锁互斥但是读写实际执行特定过程没有发生读写的并发错误 如读进程已经准备释放锁了但还没执行，这时候写进程来获取锁 再比如读进程互斥区再执行与变量无关的操作等等</p>
<ul>
<li>
<p>乐观锁一般搭配while使用  如 
    ``````
    //读的过程中也允许获取写锁后写入！这样一来，我们读的数据就可能不一致，所以，需要一点额外的代码来判断读的过程中是否有写入，这种读锁是一种乐观锁。
   public int incrementAndGet(AtomicInteger var) {
    int prev, next;
    do {
        prev = var.get();
        next = prev + 1;
    } while ( ! var.compareAndSet(prev, next));
    return next;
}</p>
<p>``````</p>
</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../CompletableFuture/" class="btn btn-neutral float-left" title="CompletableFuture"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F%E5%92%8C%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" class="btn btn-neutral float-right" title="访问者模式和编译原理">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/littlejlf/mkdocsSite" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../CompletableFuture/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F%E5%92%8C%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../javascripts/katex.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

<script>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});</script></body>
</html>
